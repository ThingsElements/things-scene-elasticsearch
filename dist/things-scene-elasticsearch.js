!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@hatiolab/things-scene"),require("elasticsearch-browser")):"function"==typeof define&&define.amd?define(["@hatiolab/things-scene","elasticsearch-browser"],t):(e=e||self)["things-scene-elasticsearch"]=t(e.scene,e.elasticsearch)}(this,function(thingsScene,elasticsearch){"use strict";elasticsearch=elasticsearch&&elasticsearch.hasOwnProperty("default")?elasticsearch.default:elasticsearch;var COMPONENT_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjdCQUQzOURFMTg0NTExRThBMDc0QUZGM0Y1MTQwNzhDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjdCQUQzOURGMTg0NTExRThBMDc0QUZGM0Y1MTQwNzhDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N0JBRDM5REMxODQ1MTFFOEEwNzRBRkYzRjUxNDA3OEMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6N0JBRDM5REQxODQ1MTFFOEEwNzRBRkYzRjUxNDA3OEMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4KOLJ3AAABUklEQVR42mL8//8/AzUBEwOVAW0M3LJlyxkQJpeNbCAjKAyhgiZkOuqMj4+PCYqBUJsYgBIoKkFiyAAmjyyOrgfFhSBJIDsKyI4E4uVAvAzNNUZA/AmI7+ByIbZIARkmCaXRQToQe+DzP4qXoQCXC0GumwXEz4HYD4j/E/QygcCfCcTGUHYKEF/A5mUWHAEuBMTMQPwayXVgw54+fSr87Nmzld++fZMBcg+rqKgIl5aWMnR3dyMMRLYBGq4tQMwBDbPfUBps2N27d+WBvmIE+Q7kbSAf5PUEIF6AkrCRDAR5xwyI9YC4DNl1r1+/FoIaBgdQfgSGl9EMhIFAKAaDz58/80BdBo8DKP0VxUCQl5Fi2QxXrPz7928HLHZhXoayd2LkZWhsgWMNFxsYAeqMjIwo5R2UvwIjHRIDQLEJjQBQmNmCYhlq2AJYLDOOvAIWIMAAzV61w1HebFoAAAAASUVORK5CYII=";const NATURE={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"host",name:"host"},{type:"number",label:"port",name:"port",placeholder:"9200"},{type:"string",label:"httpAuth",name:"httpAuth"},{type:"string",label:"index",name:"index"},{type:"string",label:"types",name:"types"},{type:"string",label:"query-string",name:"queryString"},{type:"textarea",label:"query-object",name:"queryObject"},{type:"select",label:"log",name:"log",property:{options:[{display:"trace",value:"trace"},{display:"error",value:"error"},{display:"warn",value:"warn"}]}},{type:"number",label:"period",name:"period",placeholder:"seconds"}]};class Elasticsearch extends(thingsScene.DataSource(thingsScene.RectPath(thingsScene.Shape))){static get image(){return Elasticsearch._image||(Elasticsearch._image=new Image,Elasticsearch._image.src=COMPONENT_IMAGE),Elasticsearch._image}ready(){super.ready(),this.app.isViewMode&&this._initElasticsearchConnection()}_initElasticsearchConnection(){delete this._client;var{host:host,port:port=9200,log:log="trace",index:index,types:types,queryString:queryString,queryObject:queryObject,httpAuth:httpAuth}=this.model;if(host){this._client=new elasticsearch.Client({host:`${host}:${port}`,httpAuth:httpAuth,log:log});var query={};if(queryString)query.q=queryString;else{if(!queryObject)return;try{let obj;return eval("obj="+queryObject),void thingsScene.error("query object is not an object",obj,queryObject)}catch(e){return void thingsScene.error(e)}}index&&(query.index=index),types&&(query.types=types),this._interval=setInterval(()=>{this._client.search(query,(e,t,i)=>{e?thingsScene.error(e,t,i):this.setState("data",t.hits)})},this.period)}else console.warn("host not defined")}dispose(){this._interval&&clearInterval(this._interval),delete this._client,super.dispose()}render(e){var{left:t,top:i,width:r,height:s}=this.bounds;e.beginPath(),e.drawImage(Elasticsearch.image,t,i,r,s)}get period(){return 1e3*(this.state.period||10)}get nature(){return NATURE}}thingsScene.Component.register("elasticsearch",Elasticsearch);var index=[Elasticsearch];return index});
